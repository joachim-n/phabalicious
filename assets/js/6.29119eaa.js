(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{409:function(t,s,e){t.exports=e.p+"assets/img/phab-secrets-01.def120e9.svg"},410:function(t,s,e){t.exports=e.p+"assets/img/phab-secrets-02.8d033de9.svg"},411:function(t,s,e){t.exports=e.p+"assets/img/phab-secrets-03.910bafb4.svg"},435:function(t,s,e){"use strict";e.r(s);var a=e(55),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"handling-secrets-with-phabalicious"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#handling-secrets-with-phabalicious"}},[t._v("#")]),t._v(" Handling secrets with phabalicious")]),t._v(" "),a("h2",{attrs:{id:"what-is-a-secret"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-is-a-secret"}},[t._v("#")]),t._v(" What is a secret?")]),t._v(" "),a("p",[t._v("A "),a("strong",[t._v("secret")]),t._v(" is a password, a token, or any other information which should not be publicly visible or available. Secrets "),a("strong",[t._v("must not")]),t._v(" be stored in a fabfile, or anywhere else, as they are most likely deployed to other systems and might pose a security-risk.")]),t._v(" "),a("p",[t._v("Secrets should be injected on runtime via e.g. environment variables or other mechanisms to reduce the attack surface.")]),t._v(" "),a("h2",{attrs:{id:"support-for-secrets-in-phabalicious"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#support-for-secrets-in-phabalicious"}},[t._v("#")]),t._v(" Support for secrets in phabalicious")]),t._v(" "),a("p",[t._v("Phabalicious makes it easy to declare secrets and has various ways to obtain the actual values:")]),t._v(" "),a("ul",[a("li",[t._v("from environment variables or an .env-file")]),t._v(" "),a("li",[t._v("via command-line-options")]),t._v(" "),a("li",[t._v("from 1password (cli/connect)")]),t._v(" "),a("li",[t._v("as a last resort by asking the user")])]),t._v(" "),a("h2",{attrs:{id:"example"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example"}},[t._v("#")]),t._v(" Example")]),t._v(" "),a("h3",{attrs:{id:"step-1-preparation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-1-preparation"}},[t._v("#")]),t._v(" Step 1: Preparation")]),t._v(" "),a("p",[t._v("Let's start with a very simple fabfile:")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Secrets in phabalicious\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("needs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" script\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" local\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scripts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("demo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# An example on how to consume a secret")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' echo "host.fooSecret is %host.fooSecret%"\n\n'),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("local")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fooSecret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bar\n")])])]),a("ul",[a("li",[t._v("Save the file as "),a("code",[t._v("fabfile.yaml")])]),t._v(" "),a("li",[t._v("Run the command "),a("code",[t._v("phab -clocal script demo")])])]),t._v(" "),a("p",[a("img",{attrs:{src:e(409),alt:"Example Step 1"}})]),t._v(" "),a("h3",{attrs:{id:"step-2-declare-the-secret"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-2-declare-the-secret"}},[t._v("#")]),t._v(" Step 2: Declare the secret")]),t._v(" "),a("p",[t._v("Now let's declare the secret, so phabalicious recognizes it:")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Secrets in phabalicious\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("needs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" script\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" local\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secrets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("foo-secret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("question")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" What is the secret for foo\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scripts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("demo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# An example on how to consume a secret")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' echo "host.fooSecret is %host.fooSecret%"\n\n'),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("local")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fooSecret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%secret.foo-secret%"')]),t._v("\n")])])]),a("p",[t._v("Notice the new "),a("code",[t._v("secrets")]),t._v("-section and the replacement in "),a("code",[t._v("hosts.local.fooSecret")])]),t._v(" "),a("p",[t._v("Let's run the script again and try the different ways on how to pass the secret:")]),t._v(" "),a("p",[a("img",{attrs:{src:e(410),alt:"Example Step 2"}})]),t._v(" "),a("h3",{attrs:{id:"step-3-use-1password-cli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-3-use-1password-cli"}},[t._v("#")]),t._v(" Step 3: Use 1password cli")]),t._v(" "),a("p",[t._v("If you have installed "),a("a",{attrs:{href:"https://support.1password.com/command-line-getting-started/",target:"_blank",rel:"noopener noreferrer"}},[t._v("1password cli"),a("OutboundLink")],1),t._v(" you can even simplify this even more. Add the uuid of the 1password-item to the secret declaration:")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Secrets in phabalicious\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("needs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" script\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" local\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secrets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("foo-secret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("question")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" What is the secret for foo\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("onePasswordId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 4g7jjwr7tqfadplpexbb3u4cbm\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scripts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("demo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# An example on how to consume a secret")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' echo "host.fooSecret is %host.fooSecret%"\n\n'),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("local")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fooSecret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%secret.foo-secret%"')]),t._v("\n")])])]),a("p",[t._v("Notice "),a("code",[t._v("secrets.foo-secret.onePasswordId")])]),t._v(" "),a("p",[t._v("Let's run the script again:")]),t._v(" "),a("p",[a("img",{attrs:{src:e(411),alt:"Example Step 3"}})]),t._v(" "),a("h3",{attrs:{id:"there-s-even-more"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#there-s-even-more"}},[t._v("#")]),t._v(" There's even more")]),t._v(" "),a("p",[t._v("Phabalicious supports also "),a("a",{attrs:{href:"https://support.1password.com/secrets-automation/",target:"_blank",rel:"noopener noreferrer"}},[t._v("1Password secrets automation"),a("OutboundLink")],1),t._v(" (getting secrets via a REST-API).")]),t._v(" "),a("p",[t._v("For more in-depth information please continue reading in the "),a("RouterLink",{attrs:{to:"/passwords.html"}},[t._v("official documentation")])],1)])}),[],!1,null,null,null);s.default=n.exports}}]);